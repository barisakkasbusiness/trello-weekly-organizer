<!DOCTYPE html>
<html>
<head>
  <title>Weekly Card Organizer</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
<script>
TrelloPowerUp.initialize({
  'board-buttons': function(t, options){
    return [{
      icon: 'https://img.icons8.com/color/48/000000/calendar.png',
      text: 'Organize This Week',
      callback: function(t){
        return t.lists('all')
          .then(function(lists){
            const thisWeekList = lists.find(list => list.name === 'Bu Hafta');
            if(!thisWeekList) return t.alert({message: "'Bu Hafta' list not found!"});
            
            return t.cards('all')
              .then(function(cards){
                const weekCards = cards.filter(card => card.idList === thisWeekList.id);
                
                const days = {
                  1: 'Monday',
                  2: 'Tuesday',
                  3: 'Wednesday',
                  4: 'Thursday',
                  5: 'Friday',
                  6: 'Saturday',
                  0: 'Sunday'
                };
                
                let promises = weekCards.map(card => {
                  if(!card.due) return Promise.resolve();
                  const dueDate = new Date(card.due);
                  const dayName = days[dueDate.getDay()];
                  const targetList = lists.find(l => l.name === dayName);
                  if(targetList){
                    return t.moveCard(card.id, targetList.id);
                  } else {
                    return Promise.resolve();
                  }
                });
                
                return Promise.all(promises)
                  .then(() => t.alert({message: 'Cards organized by due date!'}));
              });
          });
      }
    }];
  }
});
</script>
</body>
</html>
